<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title></title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
    integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">
  <link rel="stylesheet" type="text/css" href="css/global.css">
</head>

<body>
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
    integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous">
  </script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
    integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous">
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js"
    integrity="sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF" crossorigin="anonymous">
  </script>
  <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
    <div class="container">
      <a class="navbar-brand" href="#"><img src="images/organ_donation_red_cross_iStock-1213891617.jpg"
          class="img-thumbnail" alt="..." width="80px" height="80px"></a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item active">
            <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#registerSection">Register</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#matchSection">Match</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <header class="page-header gradient ">
    <div class="container pt-3">
      <div class="row align-items-center ">
        <div class="col-md-5 " ;>Register donor or receiver
          <button type="button" class="btn btn-primary btn-lg">Register</button>
        </div>
        <div class="col-md-5"><img src="images/1-One-donor-can-save-eight-lives.jpg" width="auto" ; height="auto" ;
            style="margin-top: 2rem; margin-bottom: 2rem; "></div>
      </div>
    </div>
  </header>
  <section class="container-fluid " style="padding-top: 1em;">
    <video width="100%" height="100%" playsinline autoplay muted loop>
      <source src="images/Design2_OTS.mp4" type="video/mp4">

      Your browser does not support the video tag.
    </video>
  </section>
  <!--REGISTRATION SECTION-->
  <hr id="registerSection">
  <h2 style="padding-left: 1em;">Register Donor/Receiver</h2>
  <section class="register">
    <div class="container-fluid pt-3">
      <div class="row">
        <div class="col-md-6 ">
          <img src="images/8lives.png" width="100%" height="100%">
        </div>
        <div class="col-md-6">
          <form>
            <div class="form-group">
              <label for="firstnameInput">First Name</label>
              <input type="text" class="form-control" id="firstnameInput">
            </div>
            <div class="form-group">
              <label for="lastnameInput">Last Name</label>
              <input type="text" class="form-control" id="lastnameInput" placeholder="">
            </div>
            <div class="form-group">
              <label for="">UserNameInput</label>
              <input type="text" class="form-control" id="UserNameInput" placeholder="">
            </div>
            <div class="form-group">
              <label for="addressInput">Address</label>
              <input type="text" class="form-control" id="addressInput" placeholder="">
            </div>
            <div class="form-group">
              <label for="">BloodGroupInput</label>
              <input type="text" class="form-control" id="BloodGroupInput" placeholder="">
            </div>
            <div class="form-group">
              <label for="cityInput">City</label>
              <input type="text" class="form-control" id="cityInput" placeholder="">
            </div>
            <div class="form-group">
              <label for="StateInput">State</label>
              <input type="text" class="form-control" id="StateInput" placeholder="">
            </div>
            <div class="dropdown">
              <button class="btn btn-secondary dropdown-toggle" type="button" id="organdropdownMenuButton"
                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Organ
              </button>
              <div class="dropdown-menu" aria-labelledby="orgdropdownMenuButton">
                <a class="dropdown-item" href=javascript:void(0);>Heart</a>
                <a class="dropdown-item" href=javascript:void(0);>Lungs</a>
                <a class="dropdown-item" href=javascript:void(0);>Liver</a>
                <a class="dropdown-item" href=javascript:void(0);>Pancreas</a>
                <a class="dropdown-item" href=javascript:void(0);>Liver</a>
                <a class="dropdown-item" href=javascript:void(0);>Tissues</a>
                <a class="dropdown-item" href=javascript:void(0);>Kidney</a>
                <a class="dropdown-item" href=javascript:void(0);>Eyes</a>
                <a class="dropdown-item" href=javascript:void(0);>Intestines</a>
              </div>
            </div>
            <script>
              var selText;
              $(".dropdown-menu a").click(function () {
                selText = $(this).text();
                $(this).parents('.dropdown').find('.dropdown-toggle').html(selText +
                  ' <span class="caret"></span>');

                // $(this).parents('.dropdown').find('.dropdown-toggle').val($(this).data('value'));

              });
            </script>
            <div class="form-group">
              <label for="UrgencyInput">Urgency</label>
              <input type="text" class="form-control" id="UrgencyInput" placeholder="">
            </div>
            <div class="form-group">
              <label for="DOBInput">DOB</label>
              <input type="text" class="form-control" id="DOBInput" placeholder="">
            </div>
            <div class="form-group">
              <label for="contactInput">Contact</label>
              <input type="text" class="form-control" id="contactInput" placeholder="">
            </div>
            <div class="form-group">
              <label for="hospitalNameInput">Hospital sName</label>
              <input type="text" class="form-control" id="hospitalNameInput" placeholder="">
            </div>
            <div class="dropdown2">
              <button class="btn btn-secondary dropdown-toggle" type="button" id="patientTypeButton"
                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Patient Type
              </button>
              <div class="dropdown-menu" aria-labelledby="ptTypeButton">
                <a class="dropdown-item" href=javascript:void(0);>Donor</a>
                <a class="dropdown-item" href=javascript:void(0);>Receiver</a>

              </div>
            </div>
            <script>
              var typeText;
              $(".dropdown-menu a").click(function () {
                typeText = $(this).text();
                $(this).parents('.dropdown2').find('.dropdown-toggle').html(typeText +
                  ' <span class="caret"></span>');
                $(this).parents('.dropdown2').find('.dropdown-toggle').val($(this).data('value'));

              });
            </script>
          </form>
          <script>
            function register() {
              // alert($("#organdropdownMenuButton").text());
              //alert(document.getElementById("patientTypeButton").value);
              var settings = {
                "url": "http://localhost:3000/user/",
                "method": "POST",
                "timeout": 0,
                "headers": {
                  "Content-Type": "application/json"
                },
                "data": JSON.stringify({
                  "FirstName": document.getElementById("firstnameInput").value,
                  "LastName": document.getElementById("lastnameInput").value,
                  "UserName": document.getElementById("UserNameInput").value,
                  "AddressOne": document.getElementById("addressInput").value,
                  "BloodGroup": document.getElementById("BloodGroupInput").value,
                  "City": document.getElementById("cityInput").value,
                  "State": document.getElementById("StateInput").value,
                  "Organ": $("#organdropdownMenuButton").text().trim(),
                  "Urgency": document.getElementById("UrgencyInput").value,
                  "DOB": document.getElementById("DOBInput").value,
                  "Contact": document.getElementById("contactInput").value,
                  "HospitalName": document.getElementById("hospitalNameInput").value,
                  "Type": $("#patientTypeButton").text().trim(),
                  "Match": ""
                }),
              };

              $.ajax(settings).done(function (response) {
                console.log(response);
                alert(response.message);
              });
            }
          </script>
        </div>

      </div>
      <div class="row justify-content-center pt-3">
        <input class="btn-primary" type="button" id="submitMatch" value="Register" onclick="register()">
      </div>
    </div>
  </section>

  <hr id="matchSection">
  <h2 style="padding-left: 1em;">Match Donor/Receiver</h2>
  <section class="allUsers ">
    <div class="container-fluid pt-3">
      <div class="row">

        <!--Donor table data-->

        <div class="col-md-6">
          <table class="table table-striped">
            <tr class="bg-info">
              <th>Select</th>
              <th>UUID</th>
              <th>userName</th>
              <th>firstName</th>
              <th>lastName</th>
              <th>organ</th>
              <th>BloodGroup</th>
              <th>Type</th>
              <th>matched ID</th>
            </tr>

            <tbody id="myTable">

            </tbody>
          </table>
          <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>

          <script>
            var myArray = []
            $.ajax({
              method: 'GET',
              url: "http://localhost:3000/user/readallUsers",
              success: function (response) {
                myArray = response.message
                buildTable(myArray)
                // console.log(typeof myArray)
                // console.log(myArray)
                // console.log("-----------------------")
                // console.log(Object.keys(myArray).length)
                // console.log(myArray[0].Key)
                // console.log(myArray[0].Record)
                // console.log(myArray[0].Record.firstName)
                // console.log(JSON.stringify(myArray))

              }
            })

            function buildTable(data) {
              var table = document.getElementById('myTable')

              for (var i = 0; i < data.length; i++) {
                //alert(data[i].Record.UUID + data[i].Record.type)
                if (data[i].Record.type.trim() == "Donor") {
                 // alert("inside")
                  var row = `<tr>
                                      <td><input type="radio" id="" name="donor" value=${data[i].Record.UUID}> </td>
                                      <td>${data[i].Record.UUID}</td>
                        <td>${data[i].Record.userName}</td>
                                      <td>${data[i].Record.firstName}</td>
                                      <td>${data[i].Record.lastName}</td>
                                      <td>${data[i].Record.organ}</td>
                                      <td>${data[i].Record.bloodGroup}</td>
                                      <td>${data[i].Record.type}</td>
                                      <td>${data[i].Record.match}</td>
                      </tr>`
                  table.innerHTML += row

                }

              }

            }
          </script>

          <!--Receiver table data-->

        </div>
        <div class="col-md-6">
          <table class="table table-striped">
            <tr class="bg-info">
              <th>Select</th>
              <th>UUID</th>
              <th>UserName</th>
              <th>FirstName</th>
              <th>LastName</th>
              <th>Organ</th>
              <th>BloodGroup</th>
              <th>Type</th>
              <th>Matched ID</th>
            </tr>
            <tbody id="myTable2">     </tbody>
          </table>

          <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>

          <script>
            var myArray2 = []
            $.ajax({
              method: 'GET',
              url: "http://localhost:3000/user/readallUsers",
              success: function (response) {
                myArray2 = response.message
                buildTable2(myArray2)
              }
            })

            function buildTable2(data) {
              var table2 = document.getElementById('myTable2')

              for (var i = 0; i < data.length; i++) {
                if (data[i].Record.type.trim() == "Receiver") {
                  var row = `<tr>
				      <td><input type="radio" id="" name="receiver" value=${data[i].Record.UUID}> </td>
                                      <td>${data[i].Record.UUID}</td>
                        <td>${data[i].Record.userName}</td>
                                      <td>${data[i].Record.firstName}</td>
                                      <td>${data[i].Record.lastName}</td>
                                      <td>${data[i].Record.organ}</td>
                                      <td>${data[i].Record.bloodGroup}</td>
                                      <td>${data[i].Record.type}</td>
                                      <td>${data[i].Record.match}</td>
                      </tr>`
                  table2.innerHTML += row

                }


              }

            }
          </script>
        </div>
      </div>

      <div class="row justify-content-center">
        <input class="btn-primary" type="button" id="submitMatch" value="Submit" onclick="submitMatch()">
        <input class="btn-primary" type="button" id="clearSelection" value="Clear" style="margin-left: 1rem;">
      </div>
    </div>
    <script>
      function submitMatch() {
        var donorRadiosBtn = document.getElementsByName('donor');
        var donor, receiver;
        for (var i = 0, length = donorRadiosBtn.length; i < length; i++) {
          if (donorRadiosBtn[i].checked) {
            // do whatever you want with the checked radio
            // alert(donorRadiosBtn[i].value);
            donor = donorRadiosBtn[i].value;
            // only one radio can be logically checked, don't check the rest
            break;
          }
        }
        var receiverRadiosBtn = document.getElementsByName('receiver');

        for (var i = 0, length = receiverRadiosBtn.length; i < length; i++) {
          if (receiverRadiosBtn[i].checked) {
            // do whatever you want with the checked radio
            //alert(receiverRadiosBtn[i].value);
            receiver = receiverRadiosBtn[i].value
            // only one radio can be logically checked, don't check the rest
            break;
          }
        }

        var settings = {
          "url": "http://localhost:3000/user/match",
          "method": "POST",
          "timeout": 0,
          "headers": {
            "Content-Type": "application/json"
          },
          "data": JSON.stringify({
            "userID_0": donor,
            "userID_1": receiver
          }),
          //"data": JSON.stringify({"userID_0":"rs","userID_1":"sk"}),
        };

        $.ajax(settings).done(function (response) {
          console.log(response);
          alert(response.message);
        });
      }
    </script>
  </section>


</body>

</html>